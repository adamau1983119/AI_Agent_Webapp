# 立即行動清單

> **日期**：2026-01-06  
> **問題**：Dashboard 顯示 500 錯誤，內容和圖片無法生成

---

## ✅ 已完成

1. ✅ **代碼修改已完成**
   - 環境變數驗證日誌
   - 圖片服務診斷端點
   - 統一使用 AIServiceFactory
   - DeepSeek API 錯誤日誌

2. ✅ **代碼已提交到 Git**
   - 所有修改已提交
   - 等待推送到遠程倉庫

---

## 🚀 立即需要執行的步驟

### 步驟 1：推送代碼到 Git（如果還沒推送）

```bash
git push
```

### 步驟 2：檢查 Railway 環境變數 ⚠️ **最重要**

在 Railway Dashboard → Variables 中確認：

**必須設置**：
- [ ] `AI_SERVICE` = `deepseek` ✅（已確認存在）
- [ ] `DEEPSEEK_API_KEY` = `<有效的 API Key>` ⚠️ **需要確認**

**圖片服務（至少設置一個）**：
- [ ] `GOOGLE_API_KEY` = `<API Key>`
- [ ] `GOOGLE_SEARCH_ENGINE_ID` = `<Engine ID>`
- 或 `UNSPLASH_ACCESS_KEY` = `<Key>`
- 或 `PEXELS_API_KEY` = `<Key>`
- 或 `PIXABAY_API_KEY` = `<Key>`

### 步驟 3：等待 Railway 自動部署

Railway 會自動檢測到 Git 推送並開始部署。

### 步驟 4：檢查新的部署日誌

部署完成後，檢查 Railway Logs，確認：
- ✅ 看到 `=== 啟動環境變數驗證 ===`
- ✅ 看到 `✅ DEEPSEEK_API_KEY 存在` 或 `⚠️ DEEPSEEK_API_KEY 不存在`
- ✅ 看到圖片服務配置狀態

### 步驟 5：測試診斷端點

訪問：
```
https://gentle-enchantment-production-1865.up.railway.app/api/v1/validate/images
```

確認返回的配置狀態。

### 步驟 6：檢查 HTTP Logs

如果仍有 500 錯誤，查看 Railway HTTP Logs，找出：
- 實際的錯誤堆疊追蹤
- AI 服務調用時的錯誤訊息
- 圖片搜尋時的錯誤訊息

---

## 🔍 預期結果

部署成功後，應該看到：

### Railway Logs 中應該出現：
```
=== 啟動環境變數驗證 ===
AI_SERVICE: deepseek
✅ DEEPSEEK_API_KEY 存在  (或 ⚠️ DEEPSEEK_API_KEY 不存在)
✅ GOOGLE_API_KEY 存在  (或 ⚠️ GOOGLE_API_KEY 不存在)
✅ GOOGLE_SEARCH_ENGINE_ID 存在  (或 ⚠️ GOOGLE_SEARCH_ENGINE_ID 不存在)
...
=== 環境變數驗證完成 ===
```

### 診斷端點應該返回：
```json
{
  "unsplash": false,
  "pexels": false,
  "pixabay": false,
  "google_api_key": true/false,
  "google_search_engine_id": true/false,
  "duckduckgo": true,
  "available_services": ["duckduckgo", ...]
}
```

---

## ⚠️ 如果問題仍然存在

如果部署後仍有 500 錯誤，請：

1. **檢查 Railway Logs** 中的實際錯誤訊息
2. **確認 `DEEPSEEK_API_KEY` 是否有效**（可能已設置但值無效）
3. **設置至少一個圖片服務的 API Key**（推薦 Google Custom Search）
4. **查看 HTTP Logs** 找出具體的錯誤堆疊追蹤

---

**生成時間**：2026-01-06  
**狀態**：代碼已提交，等待部署和環境變數檢查

