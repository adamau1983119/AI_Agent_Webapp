# 後端修復手動部署指南

## 問題說明
Git 倉庫有損壞，無法正常提交代碼。但所有後端修復已經完成，需要手動部署。

## 已完成的修復

### 1. DeepSeek API 整合
- ✅ `backend/app/services/ai/deepseek.py` - DeepSeek 服務實現
- ✅ `backend/app/config.py` - 添加 DeepSeek 配置
- ✅ `backend/app/services/ai/ai_service_factory.py` - 添加 DeepSeek 支持
- ✅ `backend/app/api/v1/contents.py` - 使用 DeepSeek 服務
- ✅ `backend/app/utils/env_validator.py` - 驗證 DeepSeek API Key

### 2. InteractionRepository 修復
- ✅ `backend/app/services/repositories/interaction_repository.py` - 修復 collection 錯誤

## 手動部署步驟

### 方法 1：通過 Railway Web 界面手動上傳（推薦）

1. **登錄 Railway**
   - 訪問 https://railway.app
   - 進入 `gentle-enchantment` 專案

2. **手動觸發重新部署**
   - 點擊 "Settings" 標籤
   - 找到 "Redeploy" 或 "Manual Deploy" 按鈕
   - 點擊觸發重新部署

3. **確認環境變數**
   確保以下環境變數已設置：
   ```
   AI_SERVICE=deepseek
   DEEPSEEK_API_KEY=sk-9995dc68272e4e2b8406af2caa557cb0
   DEEPSEEK_MODEL=deepseek-chat
   DEEPSEEK_BASE_URL=https://api.deepseek.com/v1/chat/completions
   ```

### 方法 2：使用 Railway CLI

```bash
# 安裝 Railway CLI
npm install -g @railway/cli

# 登錄
railway login

# 鏈接到專案
railway link

# 部署
railway up
```

### 方法 3：修復 Git 後重新推送

如果 Git 問題可以修復：

```bash
# 嘗試修復 Git 倉庫
git gc --prune=now
git fsck --full

# 如果修復失敗，可能需要重新克隆
cd ..
git clone <repository-url> AI_Agent_Wbbapp_for_Social_Media_Content_Generation_new
cd AI_Agent_Wbbapp_for_Social_Media_Content_Generation_new

# 手動複製修復的文件
# 然後提交和推送
```

## 驗證部署

部署完成後，檢查 Railway Logs：

1. 應該看到：
   ```
   ✅ 環境變數驗證通過
   - AI 服務: deepseek
   ```

2. 不應該看到：
   ```
   ❌ 通義千問 API Key 未設定
   ```

3. 測試內容生成：
   - 訪問前端：https://ai-agent-webapp-ten.vercel.app/topics
   - 點擊任意主題
   - 點擊「生成內容」按鈕
   - 應該不再出現「通義千問 API Key 未設定」錯誤

## 當前狀態

- ✅ 後端代碼修復完成
- ✅ 環境變數已設置（Railway）
- ❌ Git 提交失敗（倉庫損壞）
- ⏳ 等待手動觸發 Railway 重新部署

## 下一步

1. **立即行動**：在 Railway 手動觸發重新部署
2. **驗證**：檢查 Railway Logs 確認 DeepSeek 服務啟動
3. **測試**：在前端測試內容生成功能
4. **修復 Git**：之後修復 Git 倉庫問題（不影響當前功能）

