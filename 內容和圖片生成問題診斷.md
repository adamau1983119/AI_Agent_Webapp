# 內容和圖片生成問題診斷

## 🔍 問題描述

用戶報告「no text and photo」（沒有文字和照片），從截圖可以看到：
- 前端顯示「沒有圖片 (0張)」
- 前端顯示「尚未生成內容」
- Network 標籤顯示 404 錯誤（某些主題）

---

## 🔍 可能原因

### 1. 主題生成時內容和圖片生成失敗

**檢查點**：
- 排程服務是否正常運行
- 工作流是否正確執行
- 是否有錯誤日誌

### 2. 前端 API 請求失敗

**檢查點**：
- `/api/v1/contents/{topic_id}` 是否返回 404
- `/api/v1/images/{topic_id}` 是否返回空數組
- 後端服務是否正常運行

### 3. 內容和圖片生成流程未觸發

**檢查點**：
- `workflow.process_topic()` 是否被調用
- `auto_generate_content` 和 `auto_search_images` 是否為 `True`
- 是否有錯誤被吞掉

---

## ✅ 解決方案

### 方案 1: 添加手動生成按鈕

在前端 `TopicDetail.tsx` 添加：
1. **生成內容按鈕**：如果內容不存在，顯示「生成內容」按鈕
2. **搜尋圖片按鈕**：如果圖片為空，顯示「智能匹配照片」按鈕

### 方案 2: 檢查後端日誌

檢查 Railway 日誌，查看：
- 主題生成時是否有錯誤
- 內容生成是否成功
- 圖片搜尋是否成功

### 方案 3: 手動觸發生成

通過 API 手動觸發：
```bash
# 生成內容
POST /api/v1/contents/{topic_id}/generate

# 匹配照片
POST /api/v1/images/{topic_id}/match?min_count=8
```

---

## 📋 檢查清單

- [ ] 檢查後端日誌是否有錯誤
- [ ] 檢查主題是否有關聯的內容
- [ ] 檢查主題是否有關聯的圖片
- [ ] 檢查前端是否正確請求內容和圖片
- [ ] 檢查工作流是否正確執行
- [ ] 添加手動生成按鈕

---

**最後更新**: 2025-12-30

